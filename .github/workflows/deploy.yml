name: Deploy Application

on:
  push:
    branches:
      - main
  workflow_dispatch:
    inputs:
      environment:
        description: 'Environment to deploy to'
        required: true
        type: choice
        options:
          - production
          - staging
        default: 'production'

jobs:
  approval-gate:
    name: Environment Approval Gate
    runs-on: ubuntu-latest
    environment: ${{ inputs.environment || 'production' }}
    steps:
      - name: Gate checkpoint
        run: |
          echo "Environment approval granted for: ${{ inputs.environment || 'production' }}"
          echo "This job establishes the environment context for subsequent jobs"

  call-reusable-workflow:
    name: Deploy using reusable workflow
    needs: approval-gate
    uses: ./.github/_reusable.yml
    with:
      app_name: ${{ vars.APP_NAME }}
      app_project: ${{ vars.APP_PROJECT }}
      environment: ${{ inputs.environment || 'production' }}
    secrets: inherit
